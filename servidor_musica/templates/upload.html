{% extends "base.html" %}

{% block title %}Subir Música - Servidor de Música{% endblock %}

{% block content %}
<div class="upload-container">
    <h2>Subir Nueva Canción</h2>
    
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="alert">
                {% for message in messages %}
                    <p>{{ message }}</p>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    
    <form action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data" class="upload-form">
        <div class="file-input">
            <label for="file">Seleccionar archivo de música</label>
            <input type="file" id="file" name="file" accept=".mp3,.wav,.ogg,.m4a" required>
            <p class="file-info">Formatos permitidos: MP3, WAV, OGG, M4A</p>
            <p class="file-info">Tamaño máximo: 200MB</p>
            <div class="selected-file-info">Ningún archivo seleccionado</div>
        </div>
        
        {% if playlists %}
        <div class="form-group">
            <label for="playlist_id">Añadir a playlist (opcional):</label>
            <select name="playlist_id" id="playlist_id" class="form-control">
                <option value="">-- Ninguna playlist --</option>
                {% for playlist in playlists %}
                    <option value="{{ playlist.id }}">{{ playlist.title }}</option>
                {% endfor %}
            </select>
        </div>
        {% endif %}
        
        <button type="submit" class="btn primary">Subir Archivo</button>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const fileInput = document.getElementById('file');
        const fileInfoDiv = document.querySelector('.selected-file-info');
        
        fileInput.addEventListener('change', function() {
            const fileName = this.files[0] ? this.files[0].name : 'Ningún archivo seleccionado';
            fileInfoDiv.textContent = 'Archivo seleccionado: ' + fileName;
            
            if (this.files[0]) {
                fileInfoDiv.classList.add('has-file');
            } else {
                fileInfoDiv.classList.remove('has-file');
            }
        });
    });
</script>
{% endblock %}