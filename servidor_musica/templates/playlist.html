{% extends "base.html" %}

{% block title %}Mi Biblioteca - Servidor de Música{% endblock %}

{% block content %}
{% with messages = get_flashed_messages() %}
    {% if messages %}
        <div class="alert">
            {% for message in messages %}
                <p>{{ message }}</p>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}

<div class="tabs-container">
    <div class="tabs">
        <button class="tab-btn active" data-tab="all-songs">Todas las Canciones</button>
        {% if current_user.is_authenticated and playlists %}
            <button class="tab-btn" data-tab="playlists">Mis Playlists</button>
        {% endif %}
    </div>
    
    <div class="tab-content active" id="all-songs">
        <div class="playlist-container">
            <h2>Mi Biblioteca Musical</h2>
            
            {% if current_file %}
            <div class="player">
                <h3>Reproduciendo: {{ current_file }}</h3>
                <audio controls autoplay>
                    <source src="{{ url_for('static', filename='uploads/' + current_file) }}" type="audio/mpeg">
                    Tu navegador no soporta el elemento de audio.
                </audio>
            </div>
            {% endif %}
            
            {% if files %}
                <ul class="song-list">
                    {% for file in files %}
                    <li class="song-item {% if current_file == file %}active{% endif %}">
                        <span class="song-name">{{ file }}</span>
                        <div class="song-actions">
                            <a href="{{ url_for('play_file', filename=file) }}" class="btn play">▶️ Reproducir</a>
                            <a href="{{ url_for('download_file', filename=file) }}" class="btn download">⬇️ Descargar</a>
                            {% if current_user.is_authenticated %}
                                <a href="{{ url_for('add_to_playlist', filename=file) }}" class="btn add">+ Añadir a Playlist</a>
                            {% endif %}
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            {% else %}
                <div class="empty-list">
                    <p>No hay canciones disponibles. ¡Comienza subiendo tu música!</p>
                    {% if current_user.is_authenticated %}
                        <a href="{{ url_for('upload') }}" class="btn primary">Subir canciones</a>
                    {% else %}
                        <p>Inicia sesión para poder subir tus propias canciones.</p>
                        <a href="{{ url_for('login') }}" class="btn primary">Iniciar Sesión</a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
    
    {% if current_user.is_authenticated and playlists %}
        <div class="tab-content" id="playlists">
            <div class="playlists-container">
                <div class="playlists-header">
                    <h2>Mis Playlists</h2>
                    <a href="{{ url_for('create_playlist') }}" class="btn primary">Crear Nueva Playlist</a>
                </div>
                
                <ul class="playlists-grid">
                    {% for playlist in playlists %}
                    <li class="playlist-card">
                        <div class="playlist-card-inner">
                            <h3>{{ playlist.title }}</h3>
                            <a href="{{ url_for('view_playlist', playlist_id=playlist.id) }}" class="btn secondary">Ver Playlist</a>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Remove active class from all buttons and contents
                tabBtns.forEach(b => b.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // Add active class to current button and content
                this.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });
    });
</script>
{% endblock %}